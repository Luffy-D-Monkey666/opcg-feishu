{% extends "base.html" %}

{% block extra_css %}
<style>
    /* 侧边栏布局 */
    .page-wrapper {
        display: flex;
        min-height: calc(100vh - 120px);
    }
    
    .sidebar {
        width: 280px;
        flex-shrink: 0;
        background: white;
        border-right: 1px solid #e9ecef;
        position: sticky;
        top: 0;
        height: calc(100vh - 56px);
        overflow-y: auto;
    }
    
    .sidebar-content {
        padding: 1rem;
    }
    
    .sidebar-header {
        font-weight: bold;
        color: #495057;
        padding: 0.5rem 0;
        border-bottom: 2px solid #dee2e6;
        margin-bottom: 0.5rem;
    }
    
    .series-tree {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    
    .series-group {
        margin-bottom: 0.5rem;
    }
    
    .series-group-header {
        display: flex;
        align-items: center;
        padding: 0.5rem;
        background: #f8f9fa;
        border-radius: 4px;
        cursor: pointer;
        font-weight: 500;
        font-size: 0.9rem;
        user-select: none;
    }
    
    .series-group-header:hover {
        background: #e9ecef;
    }
    
    .series-group-header i {
        margin-right: 0.5rem;
        transition: transform 0.2s;
    }
    
    .series-group-header.collapsed i.bi-chevron-down {
        transform: rotate(-90deg);
    }
    
    .series-group-count {
        margin-left: auto;
        font-size: 0.75rem;
        color: #6c757d;
    }
    
    .series-list {
        list-style: none;
        padding: 0;
        margin: 0;
        padding-left: 1.5rem;
    }
    
    .series-list.collapse:not(.show) {
        display: none;
    }
    
    .series-item {
        padding: 0.35rem 0.5rem;
        border-radius: 4px;
        font-size: 0.85rem;
    }
    
    .series-item a {
        color: #495057;
        text-decoration: none;
        display: block;
    }
    
    .series-item:hover {
        background: #e3f2fd;
    }
    
    .series-item.active {
        background: #0d6efd;
    }
    
    .series-item.active a {
        color: white;
    }
    
    .main-content {
        flex: 1;
        padding: 0;
        min-width: 0;
    }
    
    /* 响应式 */
    @media (max-width: 991px) {
        .sidebar {
            display: none;
        }
        
        .sidebar-toggle {
            display: block !important;
        }
        
        .sidebar.show {
            display: block;
            position: fixed;
            left: 0;
            top: 56px;
            z-index: 1030;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }
    }
    
    .sidebar-toggle {
        display: none;
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 1040;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }
    
    /* 快速筛选按钮 */
    .quick-filters {
        display: flex;
        flex-wrap: wrap;
        gap: 0.25rem;
        margin-bottom: 1rem;
    }
    
    .quick-filter-btn {
        font-size: 0.75rem;
        padding: 0.25rem 0.5rem;
    }
</style>
{{ super() }}
{% endblock %}

{% block content %}
<div class="page-wrapper">
    <!-- 侧边栏 -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-content">
            <div class="sidebar-header">
                <i class="bi bi-folder2-open"></i> 系列导航
            </div>
            
            <!-- 快速筛选 -->
            <div class="quick-filters">
                <a href="{{ url_for('cards.card_list', lang=current_lang) }}" 
                   class="btn btn-sm {% if not current_series %}btn-primary{% else %}btn-outline-secondary{% endif %} quick-filter-btn">
                    全部
                </a>
                <a href="{{ url_for('cards.card_list', lang=current_lang, type='LEADER') }}" 
                   class="btn btn-sm btn-outline-danger quick-filter-btn">
                    <i class="bi bi-star"></i> Leader
                </a>
            </div>
            
            <!-- 系列树 -->
            <ul class="series-tree">
                {% for group_name, group_series in series_groups.items() %}
                <li class="series-group">
                    <div class="series-group-header" data-bs-toggle="collapse" data-bs-target="#group-{{ loop.index }}">
                        <i class="bi bi-chevron-down"></i>
                        <span>{{ group_name }}</span>
                        <span class="series-group-count">{{ group_series|length }}</span>
                    </div>
                    <ul class="series-list collapse show" id="group-{{ loop.index }}">
                        {% for s in group_series %}
                        <li class="series-item {% if current_series and current_series.id == s.id %}active{% endif %}">
                            <a href="{{ url_for('cards.card_list', series=s.id, lang=current_lang) }}">
                                {{ s.code }}
                            </a>
                        </li>
                        {% endfor %}
                    </ul>
                </li>
                {% endfor %}
            </ul>
        </div>
    </aside>
    
    <!-- 主内容区 -->
    <div class="main-content">
        <div class="container-fluid py-3 px-4">
            {% block main_content %}{% endblock %}
        </div>
    </div>
</div>

<!-- 移动端侧边栏切换按钮 -->
<button class="btn btn-primary sidebar-toggle" onclick="toggleSidebar()">
    <i class="bi bi-list"></i>
</button>
{% endblock %}

{% block extra_js %}
<script>
function toggleSidebar() {
    document.getElementById('sidebar').classList.toggle('show');
}

// 点击主内容区关闭侧边栏（移动端）
document.querySelector('.main-content').addEventListener('click', function() {
    if (window.innerWidth < 992) {
        document.getElementById('sidebar').classList.remove('show');
    }
});

// 折叠/展开系列组
document.querySelectorAll('.series-group-header').forEach(header => {
    header.addEventListener('click', function() {
        this.classList.toggle('collapsed');
    });
});
</script>
{{ super() }}
{% endblock %}
